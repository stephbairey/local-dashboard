# Dashboard Vibe Document

This file exists so future chats can instantly load the full mental model of the dashboard. It describes the stack, file layout, data flow, calendar pipeline, scheduler, slide architecture, and working style.

## Overview

This is a fully local home dashboard running on Windows using WAMP (Apache + PHP) and small Python fetchers. It displays:

* Clock
* Calendar (ICS feeds)
* Weather (NWS)
* Tides (NOAA) and Moon phase
* Bills (calculated from calendar titles)
* Other slides in the future

All data is fetched locally, stored in JSON, and rendered on rotating slides readable across the room.

Project root:
C:\wamp64\www\dashboard

Everything lives here: PHP, JS, CSS, Python, data, scripts, and automation.

---

# Source Control

GitHub repo:
[https://github.com/stephbairey/local-dashboard](https://github.com/stephbairey/local-dashboard)

Local root:
C:\wamp64\www\dashboard

.gitignore keeps secrets and generated data out of GitHub:

* python/config.ini
* data/
* python/_archive/
* any credentials or token files

Workflow:
git add .
git commit -m "message"
git push

Active code lives in python/ and assets/js/slides/.
Legacy or unused scripts go into python/_archive/.

---

# Stack and Paths

Frontend: PHP + vanilla JS
Backend data: JSON in data/
Python venv:
C:\wamp64\www\dashboard.venv
Use via ..venv\Scripts\python.exe

Data directory:
C:\wamp64\www\dashboard\data
Written by Python, never stored in GitHub.

---

# Python Environment

These packages must be installed in the venv:

requests
icalendar
recurring-ical-events
python-dateutil
tzdata

Install with:
..venv\Scripts\python.exe -m pip install <package>

---

# Data Flow

All data sources follow the same pattern:

1. A Python script fetches data and writes JSON into /data.
2. PHP API endpoint api/read.php serves the JSON (no caching).
3. A JS slide script in assets/js/slides/ fetches the JSON.
4. Slide HTML displays the data.

Slides rotate via assets/js/app.js.
Each slide has its own JS module in assets/js/slides/.

---

# Calendar Pipeline (ICS Only)

We use ICS feeds exclusively. No OAuth, no Google Calendar API.

Config file: python/config.ini
Section: [calendars_ics]
Each entry is label = ICS URL

Calendar fetcher:
python/fetch_calendar_ics.py

What it does:

1. Reads all ICS URLs from [calendars_ics]
2. Fetches each feed with requests
3. Parses events with icalendar
4. Expands recurring events via recurring-ical-events
5. Merges all calendars
6. Filters events from today’s local midnight to +365 days
7. Writes data/calendar.json

API endpoint:
api/read.php?file=calendar.json
Returns raw JSON with Cache-Control: no-cache.

Slide display:
slides/calendar.html (container)
assets/js/slides/calendar.js (renders events)

Bills slide:

* bills.js filters calendar events that have dollar amounts in the title
* Titles with values in parentheses (like ($123.45)) are detected
* Zoom links in location fields are normalized to a clean domain

---

# Weather, Tides, Moon

Each follows the same architecture:

weather: python/fetch_weather_nws.py
Takes data from api.weather.gov (KPDX).
Writes data/weather.json.

tides: python/fetch_tides_noaa.py
NOAA station 9440083.
Writes data/tides.json.

moon: python/fetch_moon.py
Writes data/moon.json.

Slides: assets/js/slides/weather.js, tides.js, moon.js
HTML blocks: slides/weather.html, slides/tides.html, etc.

---

# Scheduler and Automation

Windows Task Scheduler runs silent VBScript wrappers.

Example:
Dashboard Calendar Refresh
Runs every 5 minutes:
wscript.exe //B //Nologo C:\wamp64\www\dashboard\scripts\run_calendar_hidden.vbs

Wrapper uses:
C:\wamp64\www\dashboard.venv\Scripts\pythonw.exe

A “Full Refresh” job runs every 2 hours and triggers multiple fetchers.

Python may log tiny debug lines into:
data/dashboard.log

Manual test commands from project root:
..venv\Scripts\python.exe .\python\fetch_calendar_ics.py
..venv\Scripts\python.exe .\python\fetch_weather_nws.py
..venv\Scripts\python.exe .\python\fetch_tides_noaa.py
..venv\Scripts\python.exe .\python\fetch_moon.py

Check JSON freshness:
Get-Item .\data\calendar.json | fl LastWriteTime

---

# API

Simple passthrough:
api/read.php?file=calendar.json
api/read.php?file=weather.json
api/read.php?file=tides.json
api/read.php?file=moon.json

Automatically adds ?t=timestamp cache buster.

---

# Frontend Layout

index.php
Left side: large three-line clock
Right side: rotating slides container
Slides are <section> elements with:

* id="slide-xyz"
* data-endpoint="/dashboard/api/read.php?file=xyz.json"

CSS:
assets/css/styles.css
Aesthetic: large type, high contrast, translucent panels.

JS Orchestration:
assets/js/app.js

* rotates slides
* fetches each slide’s endpoint
* dispatches to slide modules

Slide modules:
assets/js/slides/
(calendar.js, bills.js, tides.js, weather.js, moon.js, etc.)

Each module registers via window.DASH.register(slideId, renderFn).

Global helpers:
escapeHtml, extractDomain, linkifyLocation

---

# Slide Module Contract

Every slide must have:

* A unique <section id="slide-name">
* A data-endpoint attribute
* A .content container inside
* A JS module in assets/js/slides/ that exports:
  init() — runs once
  update() — runs every rotation

Slides must be fast, stateless, and never block rotation.

---

# Known Decisions & Heuristics

* ICS chosen over OAuth to avoid token expiry and complexity
* All-day events detected with a midnight heuristic
* Bills detected from title patterns
* Zoom links normalized to zoom.us or zoom.com
* All fetches include a cache buster (?t=Date.now())
* Tiny logs for debugging, never verbose

---

# Working Style (for future chats)

We always work one step at a time.

Process:

1. I give a single copy-paste block.
2. You run it.
3. You report exactly what you see.
4. We adjust if needed.
5. Only then move on.

Before touching anything, we ask:

1. Is this step necessary?
2. Is it supported by the current facts?
3. Are we considering edge cases?
4. Does it make Maya’s life easier?
5. Will it solve the issue, not just investigate it?

We're excellent collaborators. We build calmly, verify every step, and keep the system stable and clear.